; PARAMETROS DE PROGRAMACAO DOS TEMPOS ENVOLVIDOS
; 200 Hz -> 1/200 s = 5000 uS
; x = 65535 - [dT*(Fosc/12)]
; x = 65535 - 5000 = 60535 = 0xEC77

		ORG	0000H
		LJMP	MAIN

		ORG	0003H
		LJMP	INT0_HANDLER
		ORG	000BH
		LJMP	T0_HANDLER

		ORG	0013H
		LJMP	INT1_HANDLER

MAIN:
		SETB	EA
		SETB	EX0
		SETB	EX1
		MOV	TMOD, #02H
		MOV	TH0, #0ECH
		MOV	TL0, #77H
		SETB	TR0
		CLR	IT1		; INTERRUPCAO EXTERNA 1: SENSIVEL A NIVEL BAIXO
		CLR	IT0
MAIN_PROG:	SETB	P1.4
MAIN_LOOP:	JNB	IT1, END_LOOP
		INC	R1
		SJMP	MAIN_LOOP
END_LOOP:	INC	R2
		SJMP	MAIN_LOOP

INT0_HANDLER:
		MOV	LSB, SIZE
		MOV	MSB, NPIECES
		ACALL	SHOW_DATA
		RETI

INT1_HANDLER:
		CLR	EA
		MOV	R0, SIZE
		SETB	EA
		RETI

T0_HANDLER:	CLR	EA
		CPL	P1.2
		MOV	TH0, #0ECH
		MOV	TL0, #77H
		SETB	EA
		RETI

SHOW_DATA:
		MOV	DPTR, #TAB
		MOV	A, LSB
		MOVC	A, @A+DPTR
		CLR	RD
		SETB	WR
		MOV	P2, A

		MOV	A, MSB
		MOVC	A, @A+DPTR
		SETB	RD
		CLR	WR
		MOV	P2, A
		RET

LSB		EQU	30H
MSB		EQU	31H
SIZE		EQU	32H
NPIECES		EQU	33H

		; *** TABELA - DIGITOS 7 SEGMENTOS - CATODO COMUM.
TAB:		DB	7EH, 30H, 6DH, 79H, 33H, 5BH, 5FH, 70H, 7FH, 7BH, 77H, 1FH, 4EH, 3DH, 4FH, 47H
		END
